(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[521],{40212:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>u});var a=l(89758),n=l(14877),i=l(56483),r=l(92450),o=l(23251),s=l(83229);const u=async function(e){const t=await e.getModuleBySymbol(n.y.SETTINGS),l=t.addPanel(a.s.TITLE,a.s.HOTKEYS,{width:350});await t.loadPromise.then((()=>{const a="meshtextures";[{panel:l,header:a,setting:"disableTextureStreamBelowLod",initialValue:()=>-1,onChange:e=>{e>-1&&(0,s.qT)().limitStreamingBelow(e)},urlParam:!0,rangePrecision:0,range:[-1,7]},{panel:l,header:a,setting:"textureStreamPause",initialValue:()=>i.ZP.debugPauseTexStream,onChange:e=>{i.ZP.debugPauseTexStream=e},urlParam:!0},{panel:l,header:a,setting:"textureStreamRaycastHits",initialValue:()=>i.ZP.debugLOD,onChange:e=>{i.ZP.debugLOD=e,e||(0,o.d)()},urlParam:!0},{panel:l,header:a,setting:"debugRTTQuality",initialValue:()=>i.ZP.debugRttQuality,onChange:t=>{i.ZP.debugRttQuality=t,t||e.commandBinder.issueCommand(new r.u({color:null},{style:r.u.selectBy.all}))},urlParam:!0},{panel:l,header:a,setting:"debugRTTScores",initialValue:()=>i.ZP.debugRttScores,onChange:t=>{i.ZP.debugRttScores=t,t||e.commandBinder.issueCommand(new r.u({color:null},{style:r.u.selectBy.all}))},urlParam:!0}].forEach((e=>t.registerMenuEntry(e)))}))}},96286:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>w,tiledMeshDebugMenu:()=>M});var a=l(5477),n=l(14877),i=l(81402),r=l(89142),o=l(28124),s=l(89758),u=l(68013),d=l(56483),c=l(70446),g=l(2212),m=l(83229),h=l(91183);function p(e,t=16){let l;const a=(0,h.k1)((()=>l=window.setInterval((()=>e()),t)),(()=>{l&&clearInterval(l)}));return a.cancel(),a}const y=new a.Z("tiled-mesh");let T=null;function b(e,t,l){T||(T=document.createElement("div"),T.style.color="#FFFFFF",T.style.fontFamily="Roboto",T.style.fontWeight="300",T.style.fontSize="12px",T.style.position="absolute",T.style.top="50px",T.style.width="500px",T.style.pointerEvents="none",T.style.whiteSpace="pre",T.style.zIndex="99999",T.style.textShadow="0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px black",document.body.appendChild(T));let a=u.t.statsTileset?function(e){var t,l,a;const n=e.tilesRenderer,i=Object.values(null!==(t=n.tileSets)&&void 0!==t?t:[])[0];return`\ntileset: version: ${null==i?void 0:i.asset.tilesetVersion}, depth: ${null===(l=null==i?void 0:i.asset.extras)||void 0===l?void 0:l.depth}, preset: ${null===(a=null==i?void 0:i.asset.extras)||void 0===a?void 0:a.preset}\n`}(e):"";a+=u.t.statsTiles?function(e,t){const l=e.tilesRenderer,a=l.visibleTiles,n={};a.forEach((e=>{var t;const l=`lod${null===(t=e.extras)||void 0===t?void 0:t.level}`,a=n[l]||0;n[l]=a+1}));const i=t.threeRenderer.info,{stats:r,downloadQueue:o,parseQueue:s,lruCache:u}=l,{active:d,downloading:c,inFrustum:g,parsing:m,used:h,visible:p}=r;return`\nthree:\n    drawCalls: ${i.render.calls}\n    geometries: ${i.memory.geometries}\n    textures: ${i.memory.textures}\n    triangles: ${i.render.triangles}\n    memory allocated (megs): ${Math.floor(t.estimatedGPUMemoryAllocated()/2**20)}\ntiles:\n    tiles in frustum: ${g}\n    visible: ${p}`+Object.keys(n).sort().map((e=>`\n     ${e} tiles: ${n[e]||0}`)).join()+`\n    downloading gltf: ${c}\n    parsing gltf: ${m}\n    active: ${d}\n    used: ${h}\n    queues:\n      download: ${o.currJobs} running, ${o.items.length} waiting\n      parse: ${s.currJobs} running, ${s.items.length} waiting\n    lruCache: ${u.itemSet.size}\n`}(e,l):"",a+=u.t.statsTextureStream?function(e){const t="downloaded:\n"+Object.keys(e.totalTextures).map((t=>`    ${t}: ${e.totalTextures[t]} `)).join("\n")+"\n";return`textureStreaming:\n    downloadingTiles: ${e.downloadingTiles} / ${e.totalTiles}\n    downloadingTextures: ${e.loadingTextures}\n`+t}(t):"",T.textContent=a}let v=null;async function M(e){if(!u.t.debug)return;const t=await e.getModuleBySymbol(n.y.SETTINGS),l=await e.getModuleBySymbol(n.y.INPUT),a=await e.getModuleBySymbol(n.y.WEBGL_RENDERER),c=a.getScene(),g=await e.getModuleBySymbol(n.y.MODEL_MESH),h=g.modelTextureLoader,T=g.modelMesh.tileLoader,M=t.tryGetProperty(d.iT,!1);function S(){v||(v=setInterval((()=>b(T,h,a)),150))}const w=t.addPanel(s.s.TITLE,s.s.HOTKEYS,{width:350}),P={viz:"visualize",stats:"stats",tile:"tileset",log:"log"},f=function(e,t,l,a,n){const i=x(l,n,((e,t)=>e.setWireframe(t))),s=function(e,t){const l={scale:1},a=(t,a)=>{if(!t)return;const n=e.container.tilesByChunkId.get(t.id),i=(null==n?void 0:n.__error)||1e-4,r=t.lod!==u.t.maxLOD&&i>u.t.errorTarget?1:.5,o=Math.max(0,Math.min(1,1-l.scale/i)),s=a?C(t.lod,o,r):null;t.setColorOverlay(s)},n=x(e,t,a),i=p((()=>n.colorize(e.container.chunks)));return{toggle:e=>{e?i.renew():i.cancel(),n.toggle(e)},colorize:n.colorize,subscription:i,config:l}}(l,n),d=x(l,n,((e,t)=>{e.setColorOverlay(t?C(e.lod,1,.5):null)})),c=x(l,n,((e,t)=>{e.setColorOverlay(t?(0,o.G1)(.5,e.id||0):null)})),g=x(l,n,((e,t)=>{var a;const n=l.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,o.G1)(.5,(0,r.un)((null===(a=null==n?void 0:n.content)||void 0===a?void 0:a.uri)||"missing")||0):null)})),h=x(l,n,((e,t)=>{e.setColorOverlay(t?(0,o.G1)(.5,(e.meshGroup<<16)+e.meshSubgroup||0):null)})),T=x(l,n,((e,t)=>{e.setColorOverlay(t?(0,o.G1)(.5,e.meshSubgroup||0):null)})),b=x(l,n,((e,t)=>{e.setColorOverlay(t?(0,o.G1)(.5,e.meshGroup||0):null)})),v=x(l,n,((e,t)=>{e.setColorOverlay(t?(0,o.G1)(.5,(0,r.un)(e.textureName)||0):null)})),M=x(l,n,((e,t)=>{const a=l.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,o.G1)(.5,(null==a?void 0:a.geometricError)||0):null)})),S=a.slots,w=(0,m.qT)(),P=x(l,n,((e,t)=>{const l=S.find((t=>t.textureName===e.textureName));if(l){const a=l.loading?1:l.quality>w.min(e.lod)?.7:.3,n=w.maxTexelSize/w.get(l.quality).texelSize;e.setColorOverlay(t?C(e.lod,n,a):null)}})),f=p((()=>P.colorize(l.container.chunks)));let O="none";const E={none:void 0,byError:s,byGeometricError:M,byTile:g,bySubgroup:T,byMeshgroup:b,bySubAndMeshgroup:h,byTexture:v,byStreamedTextures:{subscription:f,toggle:e=>{e?f.renew():f.cancel(),e&&y.info("colorize=byStreamedTextures solid color: loading, dark color: streamed, light color: basis"),P.toggle(e)}},byChunk:c,byLod:d};return[{panel:e,header:t.viz,setting:"disableTileUpdates",initialValue:()=>u.t.disableTileUpdates,onChange:e=>{u.t.disableTileUpdates=e},urlParam:!0},{panel:e,header:t.viz,setting:"wireframe",initialValue:()=>!1,onChange:i.toggle,urlParam:!0},{panel:e,header:t.viz,setting:"colorize",initialValue:()=>"none",onChange:e=>{var t,l;null===(t=E[O])||void 0===t||t.toggle(!1),null===(l=E[e])||void 0===l||l.toggle(!0),O=e},options:Object.keys(E),urlParam:!0},{panel:e,header:t.viz,setting:"colorizeByErrorScale",initialValue:()=>1,onChange:e=>{s.config.scale=e},range:[0,6],rangePrecision:3,urlParam:!0}]}(w,P,T,h,e),O=[{panel:w,header:P.stats,setting:"tilesetStatsOverlay",initialValue:()=>u.t.statsTileset,onChange:e=>{u.t.statsTileset=e,e&&S()},urlParam:!0},{panel:w,header:P.stats,setting:"tileStatsOverlay",initialValue:()=>u.t.statsTiles,onChange:e=>{u.t.statsTiles=e,e&&S()},urlParam:!0},{panel:w,header:P.stats,setting:"textureStatsOverlay",initialValue:()=>u.t.statsTextures,onChange:e=>{u.t.statsTextures=e,e&&S()},urlParam:!0},{panel:w,header:P.stats,setting:"textureStreamingOverlay",initialValue:()=>u.t.statsTextureStream,onChange:e=>{u.t.statsTextureStream=e,e&&S()},urlParam:!0}],E=[{panel:w,header:P.log,buttonName:"Log: App State",callback:()=>{y.warn(g),y.warn(l),y.warn(c),y.warn(t)}}];M&&(u.t.hideMenu||await(0,i.gw)(1e3).then((()=>{t.getSettingsGui().loadGuiPackage().then((()=>{t.getSettingsGui().toggle(t.getMainPanelId()),t.getSettingsGui().toggle(t.getMainPanelId())}))})),await(0,i.gw)(16),f.forEach((e=>t.registerMenuEntry(e))),await(0,i.gw)(16),function(e,t){return[{panel:e,header:t.tile,setting:"maxLOD",initialValue:()=>u.t.maxLOD,onChange:e=>{u.t.maxLOD=e},range:[0,3],rangePrecision:0,urlParam:!0},{panel:e,header:t.tile,setting:"errorTarget",initialValue:()=>u.t.errorTarget,onChange:e=>{u.t.errorTarget=e},range:[0,20],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile,setting:"displayActiveTiles",initialValue:()=>u.t.displayActiveTiles,onChange:e=>{u.t.displayActiveTiles=e},urlParam:!0},{panel:e,header:t.tile,setting:"loadSiblings",initialValue:()=>u.t.loadSiblings,onChange:e=>{u.t.loadSiblings=e},urlParam:!0},{panel:e,header:t.tile,setting:"autoDisableRendererCulling",initialValue:()=>u.t.autoDisableRendererCulling,onChange:e=>{u.t.autoDisableRendererCulling=e},urlParam:!0},{panel:e,header:t.tile,setting:"stopAtEmptyTiles",initialValue:()=>u.t.stopAtEmptyTiles,onChange:e=>{u.t.stopAtEmptyTiles=e},urlParam:!0},{panel:e,header:t.tile,setting:"disableTileUpdates",initialValue:()=>u.t.disableTileUpdates,onChange:e=>{u.t.disableTileUpdates=e},urlParam:!0},{panel:e,header:t.tile,setting:"disposeModel",initialValue:()=>u.t.disposeModel,onChange:e=>{u.t.disposeModel=e},urlParam:!0},{panel:e,header:t.tile,setting:"limitMemoryUsage",initialValue:()=>u.t.limitMemoryUsage,onChange:e=>{u.t.limitMemoryUsage=e},urlParam:!0},{panel:e,header:t.tile,setting:"allocatedMegsBeforeLimitingLod",initialValue:()=>u.t.allocatedMegsBeforeLimitingLod,onChange:e=>{u.t.allocatedMegsBeforeLimitingLod=e},urlParam:!0,range:[100,1e3]},{panel:e,header:t.tile,setting:"lruMinExtraTiles",initialValue:()=>u.t.lruMinExtraTiles,onChange:e=>{u.t.lruMinExtraTiles=e},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruMaxTiles",initialValue:()=>u.t.lruMaxTiles,onChange:e=>{u.t.lruMaxTiles=e},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruUnloadPercent",initialValue:()=>u.t.lruUnloadPercent,onChange:e=>{u.t.lruUnloadPercent=e},urlParam:!0,range:[0,1]},{panel:e,header:"Priority",setting:"errorMultiplierRaycastOcclusion",initialValue:()=>u.t.errorMultiplierRaycastOcclusion,onChange:e=>{u.t.errorMultiplierRaycastOcclusion=e},urlParam:!0,range:[.001,1],rangePrecision:2},{panel:e,header:"Priority",setting:"errorMultiplierHiddenFloors",initialValue:()=>u.t.errorMultiplierHiddenFloors,onChange:e=>{u.t.errorMultiplierHiddenFloors=e},urlParam:!0,range:[.001,1],rangePrecision:2}]}(w,P).forEach((e=>t.registerMenuEntry(e))),O.forEach((e=>t.registerMenuEntry(e))),E.forEach((e=>t.registerMenuButton(e))))}function x(e,t,l){let a=!1;const n=e=>{t.after(c.A.End).then((()=>{e.forEach((e=>{e&&l(e,a)}))}))},i=e.notifyOnChunksLoaded(n);i.cancel();return{toggle:t=>{t?i.renew():i.cancel(),t!==a&&(a=t,n([...e.container.chunks]))},colorize:n,subscription:i}}const S={0:new g.Vector4(1,0,0,1),1:new g.Vector4(0,1,0,1),2:new g.Vector4(0,0,1,1),3:new g.Vector4(1,1,1,1),4:new g.Vector4(1,0,1,1),5:new g.Vector4(0,1,1,1),6:new g.Vector4(1,1,0,1),7:new g.Vector4(0,0,0,1)};function C(e,t,l){var a,n;const i=null!==(n=null===(a=S[e])||void 0===a?void 0:a.clone())&&void 0!==n?n:new g.Vector4;return i.multiplyScalar(t),i.setW(l),i}const w=M},89758:(e,t,l)=>{"use strict";l.d(t,{s:()=>a});const a={TITLE:"streamed-mesh (T)",HOTKEYS:[l(43985).R.T]}},92450:(e,t,l)=>{"use strict";l.d(t,{u:()=>SetMeshOverlayCommand});var a,n,i=l(93037);!function(e){e.all="all",e.byMeshGroup="byMeshGroup",e.byMeshSubGroup="byMeshSubGroup"}(a||(a={})),function(e){e.explicit="explicit",e.random="random"}(n||(n={}));class SetMeshOverlayCommand extends i.m{constructor(e,t){super(),this.id="SET_MESH_OVERLAY_COLOR",this.payload={selectBy:(null==t?void 0:t.style)||a.all,colorStyle:(null==e?void 0:e.style)||n.explicit,color:(null==e?void 0:e.color)||null,alpha:(null==e?void 0:e.alpha)||.5,index:null==t?void 0:t.index}}}SetMeshOverlayCommand.selectBy=a,SetMeshOverlayCommand.colorBy=n,SetMeshOverlayCommand.COLOR_DIM={x:0,y:0,z:0,w:.3}},68013:(e,t,l)=>{"use strict";l.d(t,{t:()=>o});var a=l(87100),n=l(17403),i=l(2252),r=l(60050);const o={urlTemplateToken:"<file>",hideMenu:"1"!==(0,a.eY)("dmenu","0"),debug:"1"===(0,a.eY)("debugTiles","0"),displayBoxBounds:!1,initialMaxLOD:0,maxLOD:r.V.High,loadSiblings:!0,displayActiveTiles:!1,autoDisableRendererCulling:!0,optimizeRaycast:!1,stopAtEmptyTiles:!1,statsTiles:!1,statsTileset:!0,statsTextures:!1,statsTextureStream:!1,errorTarget:Number((0,a.eY)("errorTarget",(0,i.tq)()?6:4)),disableTileUpdates:!1,errorMultiplierRaycastOcclusion:.1,errorMultiplierHiddenFloors:.01,disposeModel:!1,limitMemoryUsage:(0,i.tq)(),allocatedMegsBeforeLimitingLod:350,lruMinExtraTiles:(0,i.tq)()?0:100,lruMaxTiles:800,lruUnloadPercent:.05,tileAssetRequestPriority:n.RequestPriority.MEDIUM,downloadQueueConcurrency:8,parseQueueConcurrency:10,snappingMaxLOD:r.V.Standard}},23251:(e,t,l)=>{"use strict";l.d(t,{e:()=>s,d:()=>u});var a=l(2212);const n=l(56483).ZP.sightingMaxAge,i=new a.Color;let r,o=-1;const s=(e,t)=>{r||(r=new a.InstancedMesh(new a.SphereBufferGeometry(.005,8,4),new a.MeshBasicMaterial,n),d(r));const l=new a.Matrix4;return({point:a,distance:s})=>{l.makeScale(s,s,s).setPosition(a),r.setMatrixAt(++o%n,l),r.instanceMatrix.needsUpdate=!0;for(let t=n;t--;)r.setColorAt((o-t+n)%n,i.set(e).multiplyScalar(1-t/n));r.instanceColor&&(r.instanceColor.needsUpdate=!0),r.parent||t.scene.add(r)}},u=()=>{var e;r&&(null===(e=r.parent)||void 0===e||e.remove(r),d(r))};function d(e){const t=(new a.Matrix4).makeScale(0,0,0);for(let l=0;l<n;l++)e.setMatrixAt(l,t)}}}]);